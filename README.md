# # Домашнее задание по ОС #3
###Гусев Андрей Вадимович БПИ219 - Вариант 31
- ### **Вариант 31:**
 Первая задача об Острове Сокровищ. Шайка пиратов под предводительством Джона Сильвера высадилась на берег Острова Сокровищ. Не смотря на добытую карту старого Флинта, местопо- ложение сокровищ по-прежнему остается загадкой, поэтому искать клад приходится практически на ощупь. Так как Сильвер ходит на деревянной ноге, то самому бродить по джунглям ему не с руки. Джон Сильвер поделил остров на участки, а пиратов на неболь- шие группы. Каждой группе поручается искать клад на одном из участков, а сам Сильвер ждет на берегу. Пираты, обшарив участок, возвращаются к Сильверу и докладывают о результатах. Если клад не найден, то пираты назначаются на другой участок. Требуется создать приложение, моделирующее действия Сильвера и пиратов. Примечание. Количество участков превы- шает число поисковых групп. Сильвер — сервер. Каждая группа пиратов является клиентом.
## **Суть решения (как я понял, что придумал, как реализовал)**
- Размеры острова мы узнаем когда появляемся на острове.
- Где клад и сколько там денег мы тоже не знаем.
- Сначала запускается сервер (Флинт), он хранит только данные об острове (размеры) и ждет подключения других (групп или наблюдателей).
- Когда подключаются группы он дает им задания, где искать клад.
- Группы могут сразу не найти клад(он может быть ооочень глубоко зарыт (в коде это выглядит так ```answer = (rand() % 40 == 0 ? rand() % 12345 : -1);``` ))
- Групп (как и наблюдателей) может быть сколько угодно (я подключал 3), так как каждая группа обрабатывается в новом потоке.
- Регулирование доступа к данным происходит с помощью мутексов:
```c
pthread_mutex_t mutex;
pthread_mutex_t mutex_group;
pthread_mutex_t mutex_log;
pthread_mutex_t mutex_actual_index;
```
- Когда одна из групп все таки выкапывает клад, раскопки завершаются.
- Коды на 4-5 и 6-8 баллов немного отличаются потому что я сразу не придумал как буду подключать наблюдателей.
- Команды которыми я запускал каждый элемент:
  - Сервер(Флинт):
    ```
    andriushaguseff@MacBook-Pro-Andrej 6-8 % gcc server.c -o server -lpthread
    andriushaguseff@MacBook-Pro-Andrej 6-8 % ./server 127.0.0.1 8080     
    ```
  - Клиенты(группы):
    ```
    andriushaguseff@MacBook-Pro-Andrej 6-8 % gcc client.c -o client    
    andriushaguseff@MacBook-Pro-Andrej 6-8 % ./client 127.0.0.1 8080 
    ```
  - Терминалы(наблюдатели):
    ```
    andriushaguseff@MacBook-Pro-Andrej 6-8 % gcc terminal.c -o terminal
    andriushaguseff@MacBook-Pro-Andrej 6-8 % ./terminal 127.0.0.1 8080
    ```

##Тест программы:
Сервер:
```
andriushaguseff@MacBook-Pro-Andrej 6-8 % ./server 127.0.0.1 8080
Прибыли на остров {8x8}
Ожидание подключений на адресе 127.0.0.1:8080...
Отправлено группе 1: 0 0
Отправлено группе 1: 1 0
Отправлено группе 2: 2 0
Отправлено группе 3: 3 0
Отправлено группе 1: 4 0
Отправлено группе 2: 5 0
Отправлено группе 3: 6 0
Отправлено группе 1: 7 0
Отправлено группе 2: 0 1
Отправлено группе 1: 1 1
Отправлено группе 2: 2 1
Отправлено группе 3: 3 1
Отправлено группе 1: 4 1
Отправлено группе 2: 5 1
Отправлено группе 3: 6 1
Отправлено группе 1: 7 1
Отправлено группе 2: 0 2
Отправлено группе 3: 1 2
Отправлено группе 2: 2 2
Отправлено группе 3: 3 2
Отправлено группе 1: 4 2
Отправлено группе 3: 5 2
Отправлено группе 2: 6 2
Отправлено группе 3: 7 2
Отправлено группе 1: 0 3
Отправлено группе 2: 1 3
Отправлено группе 3: 2 3
Отправлено группе 1: 3 3
Отправлено группе 2: 4 3
Отправлено группе 3: 5 3
Отправлено группе 1: 6 3
Отправлено группе 2: 7 3
Отправлено группе 3: 0 4
Отправлено группе 1: 1 4
Отправлено группе 2: 2 4
Отправлено группе 1: 3 4
Отправлено группе 3: 4 4
Отправлено группе 1: 5 4
Отправлено группе 2: 6 4
Отправлено группе 3: 7 4
Отправлено группе 1: -1 -1
Отправлено группе 2: -1 -1
Отправлено группе 3: -1 -1
Сервер закончил работу%                    
```
Терминал:
```
andriushaguseff@MacBook-Pro-Andrej 6-8 % ./terminal 127.0.0.1 8080
Подключение к серверу 127.0.0.1:8080
Привет!
Подключение нового клиента..
Ожидание статуса клиента
Клиент - Терминал

----------------

----------------

----------------

----------------

----------------

----------------

Подключение нового клиента..

Ожидание статуса клиента
Клиент - поисковая группа
Получено от 1 группы: -1
Отправлено группе 1: 0 0

----------------

Получено от 1 группы: -1

Отправлено группе 1: 1 0
Подключение нового клиента..
Ожидание статуса клиента
Клиент - поисковая группа
Получено от 2 группы: -1
Отправлено группе 2: 2 0

----------------

Подключение нового клиента..
Ожидание статуса клиента
Клиент - поисковая группа
Получено от 3 группы: -1
Отправлено группе 3: 3 0
Получено от 1 группы: -1
Отправлено группе 1: 4 0
Получено от 2 группы: -1
Отправлено группе 2: 5 0

Получено от 3 группы: -1

Отправлено группе 3: 6 0
Получено от 1 группы: -1
Отправлено группе 1: 7 0
Получено от 2 группы: -1
Отправлено группе 2: 0 1

Получено от 1 группы: -1

Отправлено группе 1: 1 1
Получено от 2 группы: -1
Отправлено группе 2: 2 1

Получено от 3 группы: -1

Отправлено группе 3: 3 1
Получено от 1 группы: -1
Отправлено группе 1: 4 1

Получено от 2 группы: -1

Отправлено группе 2: 5 1

Получено от 3 группы: -1

Отправлено группе 3: 6 1
Получено от 1 группы: -1
Отправлено группе 1: 7 1
Получено от 2 группы: -1
Отправлено группе 2: 0 2

Получено от 3 группы: -1

Отправлено группе 3: 1 2
Получено от 2 группы: -1
Отправлено группе 2: 2 2

Получено от 3 группы: -1

Отправлено группе 3: 3 2
Получено от 1 группы: -1
Отправлено группе 1: 4 2

Получено от 3 группы: -1

Отправлено группе 3: 5 2
Получено от 2 группы: -1
Отправлено группе 2: 6 2

Получено от 3 группы: -1

Отправлено группе 3: 7 2
Получено от 1 группы: -1
Отправлено группе 1: 0 3
Получено от 2 группы: -1
Отправлено группе 2: 1 3

Получено от 3 группы: -1

Отправлено группе 3: 2 3
Получено от 1 группы: -1
Отправлено группе 1: 3 3
Получено от 2 группы: -1
Отправлено группе 2: 4 3

----------------

Получено от 3 группы: -1

Отправлено группе 3: 5 3
Получено от 1 группы: -1
Отправлено группе 1: 6 3
Получено от 2 группы: -1
Отправлено группе 2: 7 3

----------------

Получено от 3 группы: -1

Отправлено группе 3: 0 4
Получено от 1 группы: -1
Отправлено группе 1: 1 4
Получено от 2 группы: -1
Отправлено группе 2: 2 4

Получено от 1 группы: -1

Отправлено группе 1: 3 4

Получено от 3 группы: -1

Отправлено группе 3: 4 4
Получено от 1 группы: -1
Отправлено группе 1: 5 4
Получено от 2 группы: -1
Отправлено группе 2: 6 4

----------------

Получено от 3 группы: -1

Отправлено группе 3: 7 4
Получено от 1 группы: 988
Группа 1 нашла 988! денег
Отправлено группе 1: -1 -1
Получено от 2 группы: -1
Отправлено группе 2: -1 -1

----------------

Получено от 3 группы: -1

Отправлено группе 3: -1 -1
Сервер закончил работу
----------------

----------------

Соединение с сервером закрыто
                
```

Клиент 1(группа 1):
```
andriushaguseff@MacBook-Pro-Andrej dz3 % ./client 127.0.0.1 8080
Подключение к серверу 127.0.0.1:8080
Группе присвоен номер 1
Клад не найден (
Флинт послал искать в {0:0}
Клад не найден (
Флинт послал искать в {1:0}
Клад не найден (
Флинт послал искать в {4:0}
Клад не найден (
Флинт послал искать в {7:0}
Клад не найден (
Флинт послал искать в {1:1}
Клад не найден (
Флинт послал искать в {4:1}
Клад не найден (
Флинт послал искать в {7:1}
Клад не найден (
Флинт послал искать в {4:2}
Клад не найден (
Флинт послал искать в {0:3}
Клад не найден (
Флинт послал искать в {3:3}
Клад не найден (
Флинт послал искать в {6:3}
Клад не найден (
Флинт послал искать в {1:4}
Клад не найден (
Флинт послал искать в {3:4}
Клад не найден (
Флинт послал искать в {5:4}
Нашли клад - 988 денег
Группа 1 закончила раскопки острова%                    
```

Клиент 2(группа 2):
```
andriushaguseff@MacBook-Pro-Andrej dz3 %  ./client 127.0.0.1 8080
Подключение к серверу 127.0.0.1:8080
Группе присвоен номер 2
Клад не найден (
Флинт послал искать в {2:0}
Клад не найден (
Флинт послал искать в {5:0}
Клад не найден (
Флинт послал искать в {0:1}
Клад не найден (
Флинт послал искать в {2:1}
Клад не найден (
Флинт послал искать в {5:1}
Клад не найден (
Флинт послал искать в {0:2}
Клад не найден (
Флинт послал искать в {2:2}
Клад не найден (
Флинт послал искать в {6:2}
Клад не найден (
Флинт послал искать в {1:3}
Клад не найден (
Флинт послал искать в {4:3}
Клад не найден (
Флинт послал искать в {7:3}
Клад не найден (
Флинт послал искать в {2:4}
Клад не найден (
Флинт послал искать в {6:4}
Клад не найден (
Группа 2 закончила раскопки острова%              
```

Клиент 3(группа 3):
```
andriushaguseff@MacBook-Pro-Andrej dz3 %  ./client 127.0.0.1 8080
Подключение к серверу 127.0.0.1:8080
Группе присвоен номер 3
Клад не найден (
Флинт послал искать в {3:0}
Клад не найден (
Флинт послал искать в {6:0}
Клад не найден (
Флинт послал искать в {3:1}
Клад не найден (
Флинт послал искать в {6:1}
Клад не найден (
Флинт послал искать в {1:2}
Клад не найден (
Флинт послал искать в {3:2}
Клад не найден (
Флинт послал искать в {5:2}
Клад не найден (
Флинт послал искать в {7:2}
Клад не найден (
Флинт послал искать в {2:3}
Клад не найден (
Флинт послал искать в {5:3}
Клад не найден (
Флинт послал искать в {0:4}
Клад не найден (
Флинт послал искать в {4:4}
Клад не найден (
Флинт послал искать в {7:4}
Клад не найден (
Группа 3 закончила раскопки острова%            
```